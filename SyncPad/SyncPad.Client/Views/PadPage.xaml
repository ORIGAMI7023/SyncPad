<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:SyncPad.Client.ViewModels"
             x:Class="SyncPad.Client.Views.PadPage"
             Title="SyncPad">

    <!-- æ¡Œé¢ç«¯ï¼šä¾§è¾¹æ å¸ƒå±€ | ç§»åŠ¨ç«¯ï¼šæ ‡ç­¾é¡µåˆ‡æ¢ -->
    <Grid Padding="0">
        <!-- ä½¿ç”¨ OnIdiom å®žçŽ°å“åº”å¼å¸ƒå±€ -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition>
                <ColumnDefinition.Width>
                    <OnIdiom x:TypeArguments="GridLength">
                        <OnIdiom.Desktop>300</OnIdiom.Desktop>
                        <OnIdiom.Tablet>0</OnIdiom.Tablet>
                        <OnIdiom.Phone>0</OnIdiom.Phone>
                    </OnIdiom>
                </ColumnDefinition.Width>
            </ColumnDefinition>
        </Grid.ColumnDefinitions>

        <!-- å·¦ä¾§ä¸»åŒºåŸŸï¼ˆæ–‡æœ¬ç¼–è¾‘ï¼‰ -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- é¡¶éƒ¨å·¥å…·æ  -->
            <Grid Grid.Row="0" Padding="10">
                <Grid.BackgroundColor>
                    <AppThemeBinding Light="#F5F5F5" Dark="#2B2B2B" />
                </Grid.BackgroundColor>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- ç”¨æˆ·ä¿¡æ¯ -->
                <Label Grid.Column="0" VerticalOptions="Center">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="ç”¨æˆ·: " FontAttributes="Bold"/>
                            <Span Text="{Binding Username}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- åˆ·æ–°æŒ‰é’® -->
                <Button Grid.Column="1"
                        Text="åˆ·æ–°"
                        Command="{Binding RefreshCommand}"
                        Margin="5,0"
                        BackgroundColor="#6C757D"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="10,5"/>

                <!-- ç™»å‡ºæŒ‰é’® -->
                <Button Grid.Column="2"
                        Text="ç™»å‡º"
                        Command="{Binding LogoutCommand}"
                        BackgroundColor="#DC3545"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="10,5"/>
            </Grid>

            <!-- æ–‡æœ¬ç¼–è¾‘åŒºåŸŸ -->
            <Editor Grid.Row="1"
                    Text="{Binding Content, Mode=TwoWay}"
                    Placeholder="åœ¨è¿™é‡Œè¾“å…¥æ–‡æœ¬..."
                    FontSize="16"
                    Margin="10">
                <Editor.BackgroundColor>
                    <AppThemeBinding Light="White" Dark="#1E1E1E" />
                </Editor.BackgroundColor>
                <Editor.TextColor>
                    <AppThemeBinding Light="Black" Dark="White" />
                </Editor.TextColor>
            </Editor>

            <!-- çŠ¶æ€æ  -->
            <Grid Grid.Row="2" Padding="10">
                <Grid.BackgroundColor>
                    <AppThemeBinding Light="#F5F5F5" Dark="#2B2B2B" />
                </Grid.BackgroundColor>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- è¿žæŽ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                <Ellipse Grid.Column="0"
                         WidthRequest="12"
                         HeightRequest="12"
                         Fill="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"
                         VerticalOptions="Center"
                         Margin="0,0,5,0"/>

                <!-- è¿žæŽ¥çŠ¶æ€æ–‡æœ¬ -->
                <Label Grid.Column="1"
                       Text="{Binding ConnectionStatus}"
                       VerticalOptions="Center"
                       FontSize="12"
                       TextColor="Gray"/>
            </Grid>
        </Grid>

        <!-- å³ä¾§æ–‡ä»¶åŒºåŸŸï¼ˆæ¡Œé¢ç«¯ï¼‰ -->
        <Grid Grid.Column="1" Padding="0">
            <Grid.BackgroundColor>
                <AppThemeBinding Light="White" Dark="#1E1E1E" />
            </Grid.BackgroundColor>
            <Grid.IsVisible>
                <OnIdiom x:TypeArguments="x:Boolean">
                    <OnIdiom.Desktop>True</OnIdiom.Desktop>
                    <OnIdiom.Tablet>False</OnIdiom.Tablet>
                    <OnIdiom.Phone>False</OnIdiom.Phone>
                </OnIdiom>
            </Grid.IsVisible>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- æ–‡ä»¶åŒºåŸŸæ ‡é¢˜æ  -->
            <Grid Grid.Row="0" Padding="10">
                <Grid.BackgroundColor>
                    <AppThemeBinding Light="#E9ECEF" Dark="#2B2B2B" />
                </Grid.BackgroundColor>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0"
                       Text="æ–‡ä»¶åˆ—è¡¨"
                       FontSize="16"
                       FontAttributes="Bold"
                       VerticalOptions="Center"/>

                <Button Grid.Column="1"
                        Text="ä¸Šä¼ "
                        Command="{Binding SelectFileCommand}"
                        BackgroundColor="#007BFF"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="10,5"/>
            </Grid>

            <!-- æ–‡ä»¶åˆ—è¡¨ -->
            <CollectionView Grid.Row="1"
                          ItemsSource="{Binding Files}"
                          SelectionMode="None">
                <CollectionView.EmptyView>
                    <StackLayout Padding="20" VerticalOptions="Center">
                        <Label Text="æš‚æ— æ–‡ä»¶"
                               FontSize="14"
                               TextColor="Gray"
                               HorizontalTextAlignment="Center"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="10,5" RowSpacing="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- å¤é€‰æ¡† -->
                            <CheckBox Grid.Column="0" Grid.RowSpan="2"
                                    IsChecked="{Binding IsSelected}"
                                    VerticalOptions="Center"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PadViewModel}}, Path=ToggleFileSelectionCommand}"
                                    CommandParameter="{Binding .}"/>

                            <!-- æ–‡ä»¶å -->
                            <Label Grid.Column="1" Grid.Row="0"
                                   Text="{Binding FileName}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   LineBreakMode="TailTruncation"/>

                            <!-- æ–‡ä»¶ä¿¡æ¯ -->
                            <Label Grid.Column="1" Grid.Row="1"
                                   FontSize="11"
                                   TextColor="Gray">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding FileSize, StringFormat='{0:N0} å­—èŠ‚'}"/>
                                        <Span Text=" Â· "/>
                                        <Span Text="{Binding UploadedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- ä¸‹è½½æŒ‰é’® -->
                            <Button Grid.Column="2" Grid.RowSpan="2"
                                    Text="ðŸ“¥"
                                    FontSize="16"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PadViewModel}}, Path=DownloadFileCommand}"
                                    CommandParameter="{Binding .}"
                                    BackgroundColor="#28A745"
                                    TextColor="White"
                                    CornerRadius="4"
                                    Padding="8"
                                    Margin="5,0"
                                    VerticalOptions="Center"/>

                            <!-- åˆ é™¤æŒ‰é’® -->
                            <Button Grid.Column="3" Grid.RowSpan="2"
                                    Text="ðŸ—‘"
                                    FontSize="16"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PadViewModel}}, Path=DeleteFileCommand}"
                                    CommandParameter="{Binding .}"
                                    BackgroundColor="#DC3545"
                                    TextColor="White"
                                    CornerRadius="4"
                                    Padding="8"
                                    VerticalOptions="Center"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
            <Grid Grid.Row="2" Padding="10" IsVisible="{Binding HasSelectedFiles}">
                <Grid.BackgroundColor>
                    <AppThemeBinding Light="#F8F9FA" Dark="#2B2B2B" />
                </Grid.BackgroundColor>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0"
                       Text="{Binding SelectedFilesText}"
                       VerticalOptions="Center"
                       FontSize="12"/>

                <Button Grid.Column="1"
                        Text="æ‰¹é‡ä¸‹è½½"
                        Command="{Binding BatchDownloadCommand}"
                        BackgroundColor="#28A745"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="8,5"
                        Margin="5,0"
                        FontSize="12"/>

                <Button Grid.Column="2"
                        Text="æ‰¹é‡åˆ é™¤"
                        Command="{Binding BatchDeleteCommand}"
                        BackgroundColor="#DC3545"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="8,5"
                        Margin="5,0"
                        FontSize="12"/>

                <Button Grid.Column="3"
                        Text="å–æ¶ˆ"
                        Command="{Binding ClearSelectionCommand}"
                        BackgroundColor="#6C757D"
                        TextColor="White"
                        CornerRadius="4"
                        Padding="8,5"
                        FontSize="12"/>
            </Grid>
        </Grid>

        <!-- ç§»åŠ¨ç«¯ï¼šæ ‡ç­¾é¡µè§†å›¾ -->
        <TabbedPage Grid.ColumnSpan="2">
            <TabbedPage.IsVisible>
                <OnIdiom x:TypeArguments="x:Boolean">
                    <OnIdiom.Desktop>False</OnIdiom.Desktop>
                    <OnIdiom.Tablet>True</OnIdiom.Tablet>
                    <OnIdiom.Phone>True</OnIdiom.Phone>
                </OnIdiom>
            </TabbedPage.IsVisible>

            <!-- æ–‡æœ¬æ ‡ç­¾é¡µ -->
            <ContentPage Title="æ–‡æœ¬">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- é¡¶éƒ¨å·¥å…·æ  -->
                    <Grid Grid.Row="0" Padding="10">
                        <Grid.BackgroundColor>
                            <AppThemeBinding Light="#F5F5F5" Dark="#2B2B2B" />
                        </Grid.BackgroundColor>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Label Grid.Column="0" VerticalOptions="Center">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="ç”¨æˆ·: " FontAttributes="Bold"/>
                                    <Span Text="{Binding Username}"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>

                        <Button Grid.Column="1"
                                Text="åˆ·æ–°"
                                Command="{Binding RefreshCommand}"
                                Margin="5,0"
                                BackgroundColor="#6C757D"
                                TextColor="White"
                                CornerRadius="4"
                                Padding="10,5"/>

                        <Button Grid.Column="2"
                                Text="ç™»å‡º"
                                Command="{Binding LogoutCommand}"
                                BackgroundColor="#DC3545"
                                TextColor="White"
                                CornerRadius="4"
                                Padding="10,5"/>
                    </Grid>

                    <Editor Grid.Row="1"
                            Text="{Binding Content, Mode=TwoWay}"
                            Placeholder="åœ¨è¿™é‡Œè¾“å…¥æ–‡æœ¬..."
                            FontSize="16"
                            Margin="10">
                        <Editor.BackgroundColor>
                            <AppThemeBinding Light="White" Dark="#1E1E1E" />
                        </Editor.BackgroundColor>
                        <Editor.TextColor>
                            <AppThemeBinding Light="Black" Dark="White" />
                        </Editor.TextColor>
                    </Editor>

                    <Grid Grid.Row="2" Padding="10">
                        <Grid.BackgroundColor>
                            <AppThemeBinding Light="#F5F5F5" Dark="#2B2B2B" />
                        </Grid.BackgroundColor>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Ellipse Grid.Column="0"
                                 WidthRequest="12"
                                 HeightRequest="12"
                                 Fill="{Binding IsConnected, Converter={StaticResource BoolToColorConverter}}"
                                 VerticalOptions="Center"
                                 Margin="0,0,5,0"/>

                        <Label Grid.Column="1"
                               Text="{Binding ConnectionStatus}"
                               VerticalOptions="Center"
                               FontSize="12"
                               TextColor="Gray"/>
                    </Grid>
                </Grid>
            </ContentPage>

            <!-- æ–‡ä»¶æ ‡ç­¾é¡µ -->
            <ContentPage Title="æ–‡ä»¶">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- æ–‡ä»¶åŒºåŸŸæ ‡é¢˜æ  -->
                    <Grid Grid.Row="0" Padding="10">
                        <Grid.BackgroundColor>
                            <AppThemeBinding Light="#E9ECEF" Dark="#2B2B2B" />
                        </Grid.BackgroundColor>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Label Grid.Column="0"
                               Text="æ–‡ä»¶åˆ—è¡¨"
                               FontSize="16"
                               FontAttributes="Bold"
                               VerticalOptions="Center"/>

                        <Button Grid.Column="1"
                                Text="ä¸Šä¼ "
                                Command="{Binding SelectFileCommand}"
                                BackgroundColor="#007BFF"
                                TextColor="White"
                                CornerRadius="4"
                                Padding="10,5"/>
                    </Grid>

                    <!-- æ–‡ä»¶åˆ—è¡¨ï¼ˆä¸Žæ¡Œé¢ç«¯ç›¸åŒï¼‰ -->
                    <CollectionView Grid.Row="1"
                                  ItemsSource="{Binding Files}"
                                  SelectionMode="None">
                        <CollectionView.EmptyView>
                            <StackLayout Padding="20" VerticalOptions="Center">
                                <Label Text="æš‚æ— æ–‡ä»¶"
                                       FontSize="14"
                                       TextColor="Gray"
                                       HorizontalTextAlignment="Center"/>
                            </StackLayout>
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="10,5" RowSpacing="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <CheckBox Grid.Column="0" Grid.RowSpan="2"
                                            IsChecked="{Binding IsSelected}"
                                            VerticalOptions="Center"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PadViewModel}}, Path=ToggleFileSelectionCommand}"
                                            CommandParameter="{Binding .}"/>

                                    <Label Grid.Column="1" Grid.Row="0"
                                           Text="{Binding FileName}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>

                                    <Label Grid.Column="1" Grid.Row="1"
                                           FontSize="11"
                                           TextColor="Gray">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding FileSize, StringFormat='{0:N0} å­—èŠ‚'}"/>
                                                <Span Text=" Â· "/>
                                                <Span Text="{Binding UploadedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}"/>
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>

                                    <Button Grid.Column="2" Grid.RowSpan="2"
                                            Text="ðŸ“¥"
                                            FontSize="16"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PadViewModel}}, Path=DownloadFileCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#28A745"
                                            TextColor="White"
                                            CornerRadius="4"
                                            Padding="8"
                                            Margin="5,0"
                                            VerticalOptions="Center"/>

                                    <Button Grid.Column="3" Grid.RowSpan="2"
                                            Text="ðŸ—‘"
                                            FontSize="16"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:PadViewModel}}, Path=DeleteFileCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#DC3545"
                                            TextColor="White"
                                            CornerRadius="4"
                                            Padding="8"
                                            VerticalOptions="Center"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
                    <Grid Grid.Row="2" Padding="10" IsVisible="{Binding HasSelectedFiles}">
                        <Grid.BackgroundColor>
                            <AppThemeBinding Light="#F8F9FA" Dark="#2B2B2B" />
                        </Grid.BackgroundColor>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Label Grid.Column="0"
                               Text="{Binding SelectedFilesText}"
                               VerticalOptions="Center"
                               FontSize="12"/>

                        <Button Grid.Column="1"
                                Text="æ‰¹é‡ä¸‹è½½"
                                Command="{Binding BatchDownloadCommand}"
                                BackgroundColor="#28A745"
                                TextColor="White"
                                CornerRadius="4"
                                Padding="8,5"
                                Margin="5,0"
                                FontSize="12"/>

                        <Button Grid.Column="2"
                                Text="æ‰¹é‡åˆ é™¤"
                                Command="{Binding BatchDeleteCommand}"
                                BackgroundColor="#DC3545"
                                TextColor="White"
                                CornerRadius="4"
                                Padding="8,5"
                                Margin="5,0"
                                FontSize="12"/>

                        <Button Grid.Column="3"
                                Text="å–æ¶ˆ"
                                Command="{Binding ClearSelectionCommand}"
                                BackgroundColor="#6C757D"
                                TextColor="White"
                                CornerRadius="4"
                                Padding="8,5"
                                FontSize="12"/>
                    </Grid>
                </Grid>
            </ContentPage>
        </TabbedPage>
    </Grid>

</ContentPage>
